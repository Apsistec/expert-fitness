(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"Rz+A":function(t,e,r){"use strict";r.r(e),r.d(e,"ProductsPageModule",(function(){return j}));var n=r("ofXK"),o=r("3Pt+"),i=r("TEn/"),s=r("i2L+"),c=r("tyNb"),a=r("mrSG"),u=r("IzEk"),l=r("lJxs"),d=r("AytR"),p="https://js.stripe.com/v3",h=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,f=null,b=function(t,e,r){if(null===t)return null;var n=t.apply(void 0,e);return function(t,e){t&&t._registerWrapper&&t._registerWrapper({name:"stripe-js",version:"1.11.0",startTime:e})}(n,r),n},v=Promise.resolve().then((function(){return null,null!==f?f:f=new Promise((function(t,e){if("undefined"!=typeof window)if(window,window.Stripe)t(window.Stripe);else try{var r=function(){for(var t=document.querySelectorAll('script[src^="'.concat(p,'"]')),e=0;e<t.length;e++){var r=t[e];if(h.test(r.src))return r}return null}();r||(r=function(t){var e=document.createElement("script");e.src="".concat(p).concat("");var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(e),e}()),r.addEventListener("load",(function(){window.Stripe?t(window.Stripe):e(new Error("Stripe.js not available"))})),r.addEventListener("error",(function(){e(new Error("Failed to load Stripe.js"))}))}catch(n){return void e(n)}else t(null)}))})),g=!1;v.catch((function(t){g||console.warn(t)}));var w=r("fXoL"),m=r("I/3d"),y=r("RgrY"),S=r("7Vn+"),x=r("Qskx");const O=[{path:"",component:(()=>{class t{constructor(t,e,r,n){this.db=t,this.fun=e,this.authService=r,this.messageService=n}ngOnInit(){this.user=this.authService.authState$.pipe(Object(u.a)(1)),this.user&&null!==this.user?(this.signedIn=!0,this.getSubscriptions()):this.signedIn=!1}getProducts(){return this.products=this.db.collection("products",t=>t.where("active","==",!0)),this.products.get(),this.products}getSubscriptions(){const t=this.db.collection("customers").doc(this.user.uid).collection("subscriptions",t=>t.where("status","in",["trialing","active"]));null==t?this.getProducts():(this.subscriptions=t.doc[0].data(),this.subscriptions.price.get().data())}subscribe(t){return Object(a.a)(this,void 0,void 0,(function*(){t.preventDefault();const e=new FormData(t.target);(yield this.db.collection("customers").doc(this.user.uid).collection("checkout_sessions").add({price:e.get("price"),allow_promotion_codes:!0,tax_rates:d.a.taxRates,success_url:window.location.origin,cancel_url:window.location.origin,metadata:{tax_rate:"10% sales tax exclusive"}})).onSnapshot(t=>Object(a.a)(this,void 0,void 0,(function*(){const{error:e,sessionId:r}=t.data();e&&this.messageService.errorAlert(e),r&&(yield function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];g=!0;var n=Date.now();return v.then((function(t){return b(t,e,n)}))}(d.a.stripePubKey)).redirectToCheckout({sessionId:r})})))}))}openBillingPortal(){return Object(a.a)(this,void 0,void 0,(function*(){const t=this.fun.httpsCallable("ext-firestore-stripe-subscriptions-createPortalLink");return yield t({returnUrl:window.location.origin})}))}get customerRole(){return this.authService.user$.pipe(Object(l.a)(t=>{})),this.customerRole}}return t.\u0275fac=function(e){return new(e||t)(w.Ob(m.a),w.Ob(y.a),w.Ob(S.a),w.Ob(x.a))},t.\u0275cmp=w.Ib({type:t,selectors:[["app-products"]],decls:0,vars:0,template:function(t,e){},styles:[".page-content[_ngcontent-%COMP%]{--background:var(--ion-color-light-shade)}.page-card[_ngcontent-%COMP%]{--background:var(--ion-color-medium-shade);border-radius:12px}.page-card-header[_ngcontent-%COMP%]{border:2px solid transparent;border-radius:12px;--background:var(--ion-color-primary-shade)}.page-card-title[_ngcontent-%COMP%]{color:var(--ion-color-warning-tint);font:800 16px/1 Roboto,sans-serif;text-transform:capitalize;font-variant:small-caps}.title-card[_ngcontent-%COMP%]{color:var(--ion-color-tertiary-tint);font:800 16px/1 Roboto,sans-serif;text-transform:uppercase}.card-subtitle-products[_ngcontent-%COMP%]{font:700 16px/1 Open Sans,sans-serif;color:var(--ion-color-light-shade);text-transform:capitalize}"]}),t})()}];let P=(()=>{class t{}return t.\u0275mod=w.Mb({type:t}),t.\u0275inj=w.Lb({factory:function(e){return new(e||t)},imports:[[c.j.forChild(O)],c.j]}),t})(),j=(()=>{class t{}return t.\u0275mod=w.Mb({type:t}),t.\u0275inj=w.Lb({factory:function(e){return new(e||t)},imports:[[n.c,o.f,o.n,i.T,P,s.a]]}),t})()}}]);